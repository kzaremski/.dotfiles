#!/bin/bash
# tmux-layout - Launch predefined tmux layouts
# Usage: tmux-layout [layout] [session_name] [directory]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LAYOUTS_DIR="$SCRIPT_DIR/layouts"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to list available layouts
list_layouts() {
    echo "Available tmux layouts:"
    echo
    for layout in "$LAYOUTS_DIR"/*.sh; do
        if [ -f "$layout" ]; then
            name=$(basename "$layout" .sh)
            echo "  â€¢ $name"
        fi
    done
    echo
    echo "Usage: tmux-layout <layout> [session_name] [directory]"
    echo "Example: tmux-layout dev myproject ~/projects/myproject"
}

# Function to launch a layout
launch_layout() {
    local layout="$1"
    local session_name="${2:-$layout}"
    local directory="${3:-$(pwd)}"

    local layout_script="$LAYOUTS_DIR/${layout}.sh"

    if [ ! -f "$layout_script" ]; then
        echo -e "${RED}Error: Layout '$layout' not found${NC}"
        echo
        list_layouts
        exit 1
    fi

    # Make script executable if it isn't
    chmod +x "$layout_script"

    # Launch the layout
    echo -e "${GREEN}Launching '$layout' layout...${NC}"
    exec "$layout_script" "$session_name" "$directory"
}

# Main logic
case "$1" in
    ""|"-h"|"--help"|"list")
        list_layouts
        ;;
    *)
        launch_layout "$@"
        ;;
esac